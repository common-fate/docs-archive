---
sidebar_position: 8
---

# Sharing of AWS Config file with the team

Sharing consistent AWS profiles amongst team members can be helpful. When writing scripts and documentation it allows you to concisely refer to a particular role which a team member should be using to do something. 
For example: ”run your development deploys using the cf-dev role”.

Granted CLI provides a Profile Registry feature. A profile registry is a git repository which is a central store of AWS profile configuration which is then synced to default aws config file `~/.aws/config`

## 1. Setting up a Profile Registry

### Using Granted CLI to setup  a Profile Registry 
TODO: Add after granted registry setup command is completed.

### Manually setting a Profile Registry
You can add any git repository to Granted CLI. However, it is recommended that you create a new repository like "granted-registry". You need to add `granted.yml` file to the root of the repository. 

The `granted.yml` file points to the AWS config files in the repository which should be synced. These config files must exist in the repository; paths pointing outside the repository such as `../config` are not permitted. Multiple config files are allowed and are merged together when syncing from the registry. If there are any duplicate profile names in the same repository, the second one will overwrite and only single profile values will be synced.

A valid `granted.yml` requires `awsConfig` key to be present. For example:
```
awsConfig:
  - ./config
  - ./other-config
```

In the above example, aws profiles inside `config` & `other-config` files will be merged and synced to your local `./aws/config` file.

## 2. Adding a Profile Registry
Provide a valid git url to `granted registry add` command to add a profile registory. Both SSH and HTTPS formats are accepted.

```
granted registry add <your-repo-git-url>
```

This will clone `<your-repo-git-url>`, load all the aws config file configured in `granted.yml` file and sync. 

You should be able to see a granted generated section inside your `/.aws/config` file such as:

```
# Granted-Registry Autogenerated Section. DO NOT EDIT.
# This section is automatically generated by Granted (https://granted.dev). Manual edits to this section will be overwritten.
# To edit, clone your profile registry repo, edit granted.yml, and push your changes. You may need to make a pull request depending on the repository settings.
# To stop syncing and remove this section, run 'granted registry remove
[granted_registry_start git@github.com:octo/granted-registry.git]

[profile dev]
sso_start_url  = <https://example.awsapps.com/start>
sso_region     = <your-sso-region>
sso_account_id = <your-sso-account-id>
sso_role_name  = <your-sso-role-name>

[granted_registry_end git@github.com:octo/granted-registry.git]
```

To avoid confusion, synced profiles are placed into a designated region in the file as shown above. This allows users to have a mix of both synced and regular profiles in their config file:

## 3. Syncing a Profile Registry 
Adding a Profile Registry is sufficient to sync the config file. Granted CLI will automatically sync your profile repositories once per day when you run `granted` or `asssume` command by default.

However, if you want to perform instant sync then you can run:

```
granted registry sync
```

This will loop over the configured profile registries, pull the latest change from remote origin and perform the sync operation. 

## 4. Removing a Profile Registry
```
granted registry remove
```
will display all the subscribed profile registries and prompt user to choose registry they want to remove.
